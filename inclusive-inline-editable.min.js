!function(a){"use strict";function b(a,b,c){c=c||{},this.settings={allowHTML:!0,disallowedTags:["input","textarea","select","button","br"]};for(var d in c)c.hasOwnProperty(d)&&(this.settings[d]=c[d]);if(this.editButton=document.querySelector(b),this.editable=document.querySelector(a),this.editable.contains(this.editButton))throw new Error("Inline editables cannot contain the buttons that control them.");this.editMode=!1,this.keyConfirm=function(a){var b=a.which||a.keyCode||0;(13===b||83===b&&(a.ctrlKey||a.metaKey))&&(a.preventDefault(),this.saveEdit(),this.valid&&this.editButton.focus())},this.editable.addEventListener("keydown",this.keyConfirm.bind(this)),this.editButton.addEventListener("click",this.toggleMode.bind(this)),this._listeners={}}b.prototype.startEdit=function(){if(this.editable.setAttribute("contenteditable",!0),this.editable.setAttribute("role","textbox"),this.settings.allowHTML&&(this.editable.textContent=this.editable.innerHTML),document.createRange){var a=document.createRange();a.selectNodeContents(this.editable),a.collapse(!1);var b=window.getSelection();b.removeAllRanges(),b.addRange(a)}return this.editable.focus(),this.editMode=!0,this._fire("startEdit",{editButton:this.editButton,editable:this.editable}),this},b.prototype.saveEdit=function(){this.valid=!0;var a=document.createElement("span");if(a.innerHTML=this.editable.textContent,this.settings.allowHTML){this.settings.disallowedTags.push("script");var b=a.querySelectorAll(this.settings.disallowedTags.join(","));Array.prototype.forEach.call(b,function(a){a&&(this.valid=!1,this._fire("disallowed",{editButton:this.editButton,editable:this.editable,badElement:a}))}.bind(this))}return this.valid&&(this.editable.removeAttribute("contenteditable"),this.editable.removeAttribute("role"),this.settings.allowHTML&&(this.editable.innerHTML=a.innerHTML),this.settings.ARIALabels?this.editButton.setAttribute("aria-label",this.settings.editLabel):this.editButton.textContent=this.settings.editLabel,this.editMode=!1,this._fire("saveEdit",{editButton:this.editButton,editable:this.editable})),this},b.prototype.toggleMode=function(){return this.editMode?this.saveEdit():this.startEdit(),this},b.prototype._fire=function(a,b){(this._listeners[a]||[]).forEach(function(a){a(b)})},b.prototype.on=function(a,b){return void 0===this._listeners[a]&&(this._listeners[a]=[]),this._listeners[a].push(b),this},b.prototype.off=function(a,b){var c=this._listeners[a].indexOf(b);return c>-1&&this._listeners[a].splice(c,1),this},b.prototype.destroy=function(){return this.editButton.removeEventListener("click",this.toggleMode),this.editable.removeEventListener("keydown",this.keyConfirm),this._listeners={},this._fire("destroy"),this},"undefined"!=typeof module&&void 0!==module.exports?module.exports=b:"function"==typeof define&&define.amd?define("InlineEditable",[],function(){return b}):"object"==typeof a&&(a.InlineEditable=b)}(this);
