/*! inclusive-inline-editable 0.1.2 — © Heydon Pickering */
(function(global){"use strict";function InlineEditable(editable,button,options){options=options||{};this.settings={saveLabel:"save",ARIALabels:false,allowHTML:true,disallowedTags:["input","textarea","select","button","br"]};for(var setting in options){if(options.hasOwnProperty(setting)){this.settings[setting]=options[setting]}}this.editButton=document.querySelector(button);var hasTextNode=this.editButton.textContent!=="";this.settings.editLabel=hasTextNode?this.editButton.textContent:"edit";this.editable=document.querySelector(editable);if(this.editable.contains(this.editButton)){throw new Error("Inline editables cannot contain the buttons that control them.")}if(this.settings.ARIALabels){this.editButton.setAttribute("aria-label",this.settings.editLabel)}else{this.editButton.textContent=this.settings.editLabel}this.editMode=false;this.keyConfirm=function(e){var key=e.which||e.keyCode||0;if(key===13||key===83&&(e.ctrlKey||e.metaKey)){e.preventDefault();this.exitEditMode();if(this.valid){this.editButton.focus()}}};this.editable.addEventListener("keydown",this.keyConfirm.bind(this));this.editButton.addEventListener("click",this.toggleMode.bind(this));this._listeners={}}InlineEditable.prototype.enterEditMode=function(){this.editable.setAttribute("contenteditable",true);this.editable.setAttribute("role","textbox");if(this.settings.ARIALabels){this.editButton.setAttribute("aria-label",this.settings.saveLabel)}else{this.editButton.textContent=this.settings.saveLabel}if(this.settings.allowHTML){this.editable.textContent=this.editable.innerHTML}if(document.createRange){var range=document.createRange();range.selectNodeContents(this.editable);range.collapse(false);var selection=window.getSelection();selection.removeAllRanges();selection.addRange(range)}this.editable.focus();this.editMode=true;this._fire("enterEditMode");return this};InlineEditable.prototype.exitEditMode=function(){this.valid=true;var proxy=document.createElement("span");proxy.innerHTML=this.editable.textContent;if(this.settings.allowHTML){this.settings.disallowedTags.push("script");var childElems=proxy.querySelectorAll(this.settings.disallowedTags.join(","));Array.prototype.forEach.call(childElems,function(childElem){if(childElem){this.valid=false;this._fire("disallowed",childElem)}}.bind(this))}if(this.valid){this.editable.removeAttribute("contenteditable");this.editable.removeAttribute("role");if(this.settings.allowHTML){this.editable.innerHTML=proxy.innerHTML}if(this.settings.ARIALabels){this.editButton.setAttribute("aria-label",this.settings.editLabel)}else{this.editButton.textContent=this.settings.editLabel}this.editMode=false;this._fire("save",this.editable.innerHTML)}return this};InlineEditable.prototype.toggleMode=function(){if(this.editMode){this.exitEditMode()}else{this.enterEditMode()}return this};InlineEditable.prototype._fire=function(type,data){var listeners=this._listeners[type]||[];listeners.forEach(function(listener){listener(data)})};InlineEditable.prototype.on=function(type,handler){if(typeof this._listeners[type]==="undefined"){this._listeners[type]=[]}this._listeners[type].push(handler);return this};InlineEditable.prototype.off=function(type,handler){var index=this._listeners[type].indexOf(handler);if(index>-1){this._listeners[type].splice(index,1)}return this};InlineEditable.prototype.destroy=function(){this.editButton.removeEventListener("click",this.toggleMode);this.editable.removeEventListener("keydown",this.keyConfirm);this._listeners={};this._fire("destroy");return this};if(typeof module!=="undefined"&&typeof module.exports!=="undefined"){module.exports=InlineEditable}else if(typeof define==="function"&&define.amd){define("InlineEditable",[],function(){return InlineEditable})}else if(typeof global==="object"){global.InlineEditable=InlineEditable}})(this);
